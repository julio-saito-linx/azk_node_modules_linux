"use strict";
var $___46__46__47_docker_45_hub__,
    $___46__46__47_docker_45_registry__,
    $___46__46__47_docker_45_remote__,
    $___46__46__47_fs_45_helper__;
var DockerHub = ($___46__46__47_docker_45_hub__ = require("../docker-hub"), $___46__46__47_docker_45_hub__ && $___46__46__47_docker_45_hub__.__esModule && $___46__46__47_docker_45_hub__ || {default: $___46__46__47_docker_45_hub__}).default;
var DockerRegistry = ($___46__46__47_docker_45_registry__ = require("../docker-registry"), $___46__46__47_docker_45_registry__ && $___46__46__47_docker_45_registry__.__esModule && $___46__46__47_docker_45_registry__ || {default: $___46__46__47_docker_45_registry__}).default;
var DockerRemote = ($___46__46__47_docker_45_remote__ = require("../docker-remote"), $___46__46__47_docker_45_remote__ && $___46__46__47_docker_45_remote__.__esModule && $___46__46__47_docker_45_remote__ || {default: $___46__46__47_docker_45_remote__}).default;
var FsHelper = ($___46__46__47_fs_45_helper__ = require("../fs-helper"), $___46__46__47_fs_45_helper__ && $___46__46__47_fs_45_helper__.__esModule && $___46__46__47_fs_45_helper__ || {default: $___46__46__47_fs_45_helper__}).default;
var path = require('path');
var Q = require('q');
var log = require('../helpers/logger');
var _ = require('lodash');
var prettyBytes = require('pretty-bytes');
var async = require('async');
var ProgressBar = require('progress');
var os = require('os');
var fsHelper = new FsHelper();
Q.onerror = function(title, err) {
  log.error('\n\n', title, err);
  throw err;
};
var Syncronizer = function Syncronizer(dockerode_options, request_options) {
  this.dockerHub = new DockerHub(request_options);
  this.dockerRegistry = new DockerRegistry(request_options);
  this.dockerRemote = new DockerRemote(dockerode_options);
};
($traceurRuntime.createClass)(Syncronizer, {
  compare: function(hubResult, tag) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var imageId,
          registryAncestors,
          fullTagName,
          imagesFound,
          localAncestors,
          localImageInspectors,
          localIds,
          diff;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = 2;
              return this.dockerRegistry.getImageIdByTag(hubResult, tag);
            case 2:
              imageId = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              $ctx.state = 6;
              return this.dockerRegistry.ancestry(hubResult, imageId);
            case 6:
              registryAncestors = $ctx.sent;
              $ctx.state = 8;
              break;
            case 8:
              log.info('  registry layers count:', registryAncestors.length);
              fullTagName = hubResult.namespace + '/' + hubResult.repository + ':' + tag;
              if (hubResult.namespace === 'library') {
                fullTagName = hubResult.repository + ':' + tag;
              }
              $ctx.state = 25;
              break;
            case 25:
              $ctx.state = 10;
              return this.dockerRemote.searchImagesByTag(fullTagName);
            case 10:
              imagesFound = $ctx.sent;
              $ctx.state = 12;
              break;
            case 12:
              $ctx.state = (!imagesFound || imagesFound.length === 0) ? 15 : 14;
              break;
            case 15:
              log.debug('\n\n:: syncronizer - compare - no local image for ' + fullTagName + ' ::');
              log.debug(registryAncestors);
              log.info('  local layers found   :', 0);
              $ctx.state = 16;
              break;
            case 16:
              $ctx.returnValue = registryAncestors;
              $ctx.state = -2;
              break;
            case 14:
              $ctx.state = 19;
              return this.dockerRemote.anscestors(imagesFound[0].Id);
            case 19:
              localAncestors = $ctx.sent;
              $ctx.state = 21;
              break;
            case 21:
              log.info('    local layers found:', localAncestors.length);
              localImageInspectors = _.pluck(localAncestors, 'imageInspect');
              localIds = _.pluck(localImageInspectors, 'Id');
              diff = _.difference(registryAncestors, localIds);
              log.debug('\n\n:: syncronizer - compare registryAncestors ::');
              log.debug(registryAncestors);
              log.debug('\n\n:: syncronizer - compare localIds ::');
              log.debug(localIds);
              log.debug('\n\n:: syncronizer - compare diff ::');
              log.debug(diff);
              log.info('    diff images:', diff.length);
              $ctx.state = 27;
              break;
            case 27:
              $ctx.returnValue = diff;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  getSizes: function(hubResult, layersList) {
    return new Q.Promise(function(resolve, reject) {
      try {
        var allChecks = [];
        for (var i = 0; i < layersList.length; i++) {
          var layerID = layersList[i];
          allChecks.push(this.dockerRegistry.downloadImageGetSize(hubResult, layerID));
        }
        async.parallelLimit(allChecks, 10, function(err, results) {
          if (err) {
            return reject(err);
          }
          var totalSize = _.reduce(results, function(sum, num) {
            return sum + num;
          }, 0);
          log.debug('\n\n:: syncronizer - getSizes ::');
          log.debug('layers:', layersList.length);
          return resolve(totalSize);
        });
      } catch (err) {
        log.error(err.stack);
        reject(err);
      }
    }.bind(this));
  },
  checkDownloadedFiles: function(layersList, outputPath) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var layerToDownload,
          i,
          layerID,
          filename,
          fileExists;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              layerToDownload = [];
              $ctx.state = 15;
              break;
            case 15:
              i = 0;
              $ctx.state = 11;
              break;
            case 11:
              $ctx.state = (i < layersList.length) ? 5 : 9;
              break;
            case 8:
              i++;
              $ctx.state = 11;
              break;
            case 5:
              layerID = layersList[i];
              filename = path.join(outputPath, layerID + '.tar');
              $ctx.state = 6;
              break;
            case 6:
              $ctx.state = 2;
              return fsHelper.fsExists(filename);
            case 2:
              fileExists = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              if (!fileExists) {
                layerToDownload.push(layerID);
              }
              $ctx.state = 8;
              break;
            case 9:
              $ctx.returnValue = layerToDownload;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  downloadCallback: function(hubResult, outputPath, imageId, iProgress) {
    return function(callback) {
      try {
        Q.spawn($traceurRuntime.initGeneratorFunction(function $__5() {
          var $__6,
              $__7,
              $__8,
              $__9,
              $__10;
          return $traceurRuntime.createGeneratorInstance(function($ctx) {
            while (true)
              switch ($ctx.state) {
                case 0:
                  $__6 = this.dockerRegistry;
                  $__7 = $__6.prepareLoading;
                  $__8 = $__7.call($__6, hubResult, outputPath, imageId, iProgress);
                  $ctx.state = 6;
                  break;
                case 6:
                  $ctx.state = 2;
                  return $__8;
                case 2:
                  $__9 = $ctx.sent;
                  $ctx.state = 4;
                  break;
                case 4:
                  $__10 = callback(null, $__9);
                  $ctx.state = -2;
                  break;
                default:
                  return $ctx.end();
              }
          }, $__5, this);
        }).bind(this));
      } catch (err) {
        log.error(err.stack);
      }
    }.bind(this);
  },
  loadCallback: function(hubResult, outputPath, imageId, iProgress) {
    return function(callback) {
      Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
        var result;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                $ctx.state = 2;
                return this.dockerRemote.loadImage(outputPath, imageId);
              case 2:
                result = $ctx.sent;
                $ctx.state = 4;
                break;
              case 4:
                if (iProgress) {
                  iProgress(1);
                }
                callback(null, result);
                $ctx.state = -2;
                break;
              default:
                return $ctx.end();
            }
        }, $__5, this);
      }).bind(this))();
    }.bind(this);
  },
  downloadList: function(hubResult, outputPath, imageIdList, iProgress) {
    return new Q.Promise(function(resolve, reject) {
      try {
        var allDownloads = [];
        for (var i = (imageIdList.length - 1); i >= 0; i--) {
          var layerID = imageIdList[i];
          allDownloads.push(this.downloadCallback(hubResult, outputPath, layerID, iProgress));
        }
        async.parallelLimit(allDownloads, 6, function(err, results) {
          log.debug('\n\n:: syncronizer - downloadAndLoadList ::');
          log.debug('outputs:', results);
          resolve(results);
        });
      } catch (err) {
        log.error(err.stack);
        reject(err);
      }
    }.bind(this));
  },
  loadList: function(hubResult, outputPath, imageIdList, iProgress) {
    return new Q.Promise(function(resolve, reject) {
      try {
        var allLoads = [];
        for (var i = (imageIdList.length - 1); i >= 0; i--) {
          var layerID = imageIdList[i];
          allLoads.push(this.loadCallback(hubResult, outputPath, layerID, iProgress));
        }
        async.parallelLimit(allLoads, 1, function(err, results) {
          log.debug('\n\n:: syncronizer - downloadAndLoadList ::');
          log.debug('outputs:', results);
          return resolve(results);
        });
      } catch (err) {
        log.error(err.stack);
        reject(err);
      }
    }.bind(this));
  },
  setTags: function(hubResult) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var tags,
          results,
          $__11,
          $__12,
          $__13,
          $__14,
          name,
          tagName,
          imageId,
          result;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = 2;
              return this.dockerRegistry.tags(hubResult);
            case 2:
              tags = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              results = [];
              $ctx.state = 27;
              break;
            case 27:
              $__11 = [];
              $__12 = tags;
              for ($__13 in $__12)
                $__11.push($__13);
              $ctx.state = 23;
              break;
            case 23:
              $__14 = 0;
              $ctx.state = 21;
              break;
            case 21:
              $ctx.state = ($__14 < $__11.length) ? 17 : 19;
              break;
            case 12:
              $__14++;
              $ctx.state = 21;
              break;
            case 17:
              name = $__11[$__14];
              $ctx.state = 18;
              break;
            case 18:
              $ctx.state = (!(name in $__12)) ? 12 : 15;
              break;
            case 15:
              $ctx.state = (tags.hasOwnProperty(name)) ? 9 : 12;
              break;
            case 9:
              tagName = name;
              imageId = tags[name];
              log.debug('\n\n:: syncronizer - setTag - search image ::');
              log.debug(tagName, imageId);
              $ctx.state = 10;
              break;
            case 10:
              $ctx.state = 6;
              return this.dockerRemote.setImageTag(hubResult.namespace, hubResult.repository, imageId, tagName);
            case 6:
              result = $ctx.sent;
              $ctx.state = 8;
              break;
            case 8:
              results.push(result);
              $ctx.state = 12;
              break;
            case 19:
              $ctx.returnValue = results;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  sync: function(hubResult, tag, outputPath, forceOverwrite) {
    var progressMessage,
        bar,
        iProgress;
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var imageFullName,
          totalLayersToLoad,
          diffFilesToDownload,
          totalSize;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = (!outputPath) ? 5 : 4;
              break;
            case 5:
              outputPath = this.getOsTempDir();
              log.info('creating temp folder', outputPath);
              $ctx.state = 6;
              break;
            case 6:
              $ctx.state = 2;
              return this.createAndCleanTempDir(outputPath);
            case 2:
              $ctx.maybeThrow();
              $ctx.state = 4;
              break;
            case 4:
              imageFullName = hubResult.namespace + '/' + hubResult.repository + ':' + tag;
              log.info('syncing', imageFullName);
              log.info('  comparing docker registry with local images...');
              $ctx.state = 44;
              break;
            case 44:
              $ctx.state = 9;
              return this.compare(hubResult, tag);
            case 9:
              totalLayersToLoad = $ctx.sent;
              $ctx.state = 11;
              break;
            case 11:
              log.info('  getting total size...');
              $ctx.state = 46;
              break;
            case 46:
              $ctx.state = (forceOverwrite) ? 18 : 16;
              break;
            case 18:
              log.info('  (force overwrite is active)...');
              diffFilesToDownload = totalLayersToLoad;
              $ctx.state = 19;
              break;
            case 16:
              log.info('  checking already downloaded files...');
              $ctx.state = 17;
              break;
            case 17:
              $ctx.state = 13;
              return this.checkDownloadedFiles(totalLayersToLoad, outputPath);
            case 13:
              diffFilesToDownload = $ctx.sent;
              $ctx.state = 19;
              break;
            case 19:
              $ctx.state = 22;
              return this.getSizes(hubResult, diffFilesToDownload);
            case 22:
              totalSize = $ctx.sent;
              $ctx.state = 24;
              break;
            case 24:
              $ctx.state = (totalSize > 0) ? 31 : 28;
              break;
            case 31:
              $ctx.state = (diffFilesToDownload.length > 0) ? 29 : 28;
              break;
            case 29:
              log.info('  downloading ' + diffFilesToDownload.length + ' layers ' + prettyBytes(totalSize) + '...');
              progressMessage = '        [:bar] :percent ( time elapsed: :elapsed seconds )';
              bar = new ProgressBar(progressMessage, {
                complete: '=',
                incomplete: ' ',
                width: 23,
                total: totalSize
              });
              iProgress = function(chunkSize) {
                bar.tick(chunkSize);
              };
              $ctx.state = 30;
              break;
            case 30:
              $ctx.state = 26;
              return this.downloadList(hubResult, outputPath, diffFilesToDownload, iProgress);
            case 26:
              $ctx.maybeThrow();
              $ctx.state = 28;
              break;
            case 28:
              log.info('  download folder: `' + outputPath + '`');
              log.info('  loading ' + totalLayersToLoad.length + ' layers...');
              progressMessage = '        [:bar] :percent ( time elapsed: :elapsed seconds )';
              bar = new ProgressBar(progressMessage, {
                complete: '=',
                incomplete: ' ',
                width: 23,
                total: totalLayersToLoad.length
              });
              iProgress = function(num) {
                bar.tick(num);
              };
              $ctx.state = 48;
              break;
            case 48:
              $ctx.state = 34;
              return this.loadList(hubResult, outputPath, totalLayersToLoad, iProgress);
            case 34:
              $ctx.maybeThrow();
              $ctx.state = 36;
              break;
            case 36:
              log.info('  setting tags...');
              $ctx.state = 50;
              break;
            case 50:
              $ctx.state = 38;
              return this.setTags(hubResult);
            case 38:
              $ctx.maybeThrow();
              $ctx.state = 40;
              break;
            case 40:
              log.info('finished loading', imageFullName);
              $ctx.state = 52;
              break;
            case 52:
              $ctx.returnValue = true;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  createAndCleanTempDir: function(dir) {
    return fsHelper.createCleanFolder(dir);
  },
  createTempDir: function(dir) {
    return fsHelper.createFolder(dir);
  },
  getOsTempDir: function(folderName) {
    var tempFolderName = folderName || 'docker-registry-downloader-temp';
    return path.join(os.tmpdir(), tempFolderName);
  },
  removeTempDir: function(dir) {
    return fsHelper.removeDirRecursive(dir);
  },
  getTotalSize: function(hubResult, tag) {
    return new Q.Promise(function(resolve, reject) {
      try {
        Q.spawn($traceurRuntime.initGeneratorFunction(function $__5() {
          var imageFullName,
              totalLayersToLoad,
              totalSize;
          return $traceurRuntime.createGeneratorInstance(function($ctx) {
            while (true)
              switch ($ctx.state) {
                case 0:
                  imageFullName = hubResult.namespace + '/' + hubResult.repository + ':' + tag;
                  log.info('comparing docker registry with local images...');
                  $ctx.state = 10;
                  break;
                case 10:
                  $ctx.state = 2;
                  return this.compare(hubResult, tag);
                case 2:
                  totalLayersToLoad = $ctx.sent;
                  $ctx.state = 4;
                  break;
                case 4:
                  log.info('getting total size', imageFullName);
                  $ctx.state = 12;
                  break;
                case 12:
                  $ctx.state = 6;
                  return this.getSizes(hubResult, totalLayersToLoad);
                case 6:
                  totalSize = $ctx.sent;
                  $ctx.state = 8;
                  break;
                case 8:
                  if (totalSize > 0 && totalLayersToLoad.length > 0) {
                    log.info('  layers to download: ' + totalLayersToLoad.length);
                    log.info('  total layers size : ' + prettyBytes(totalSize));
                  }
                  resolve({
                    layersCount: totalLayersToLoad.length,
                    totalSize: totalSize
                  });
                  $ctx.state = -2;
                  break;
                default:
                  return $ctx.end();
              }
          }, $__5, this);
        }).bind(this));
      } catch (err) {
        log.error(err.stack);
        reject(err);
      }
    }.bind(this));
  },
  getTotalLocalSize: function(hubResult, tag) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var fullTagName,
          imagesFound,
          localAncestors,
          total_local_size;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              fullTagName = hubResult.namespace + '/' + hubResult.repository + ':' + tag;
              if (hubResult.namespace === 'library') {
                fullTagName = hubResult.repository + ':' + tag;
              }
              $ctx.state = 15;
              break;
            case 15:
              $ctx.state = 2;
              return this.dockerRemote.searchImagesByTag(fullTagName);
            case 2:
              imagesFound = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              $ctx.state = (!imagesFound || imagesFound.length === 0) ? 5 : 6;
              break;
            case 5:
              $ctx.returnValue = ({
                total_local_size: 0,
                localAncestors: [],
                imagesFound: imagesFound
              });
              $ctx.state = -2;
              break;
            case 6:
              $ctx.state = 9;
              return this.dockerRemote.anscestors(imagesFound[0].Id);
            case 9:
              localAncestors = $ctx.sent;
              $ctx.state = 11;
              break;
            case 11:
              total_local_size = _.reduce(localAncestors, function(sum, anscestor) {
                return sum + anscestor.imageInspect.Size;
              }, 0);
              log.debug('\n\n:: syncronizer - getTotalLocalSize ' + fullTagName + ' ::');
              log.debug(prettyBytes(total_local_size));
              $ctx.state = 17;
              break;
            case 17:
              $ctx.returnValue = ({
                total_local_size: total_local_size,
                localAncestors: localAncestors,
                imagesFound: imagesFound
              });
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  getAllLayersFromRegistry: function(hubResult, tag) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var imageId,
          registryAncestors;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = 2;
              return this.dockerRegistry.getImageIdByTag(hubResult, tag);
            case 2:
              imageId = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              $ctx.state = 6;
              return this.dockerRegistry.ancestry(hubResult, imageId);
            case 6:
              registryAncestors = $ctx.sent;
              $ctx.state = 8;
              break;
            case 8:
              $ctx.returnValue = ({
                hub_result: hubResult,
                image_id: imageId,
                registry_layers: registryAncestors
              });
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  checkLocalLayer: function(image_id) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var image,
          inspected_image;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = 2;
              return this.dockerRemote.getImage(image_id);
            case 2:
              image = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              $ctx.state = 6;
              return this.dockerRemote.inspectImage(image);
            case 6:
              inspected_image = $ctx.sent;
              $ctx.state = 8;
              break;
            case 8:
              $ctx.returnValue = inspected_image;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  getLayersDiff: function(hubResult, tag) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var registry_result,
          registry_layers_ids,
          non_existent_locally_ids,
          i,
          registry_layer,
          local_layer;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $ctx.state = 2;
              return this.getAllLayersFromRegistry(hubResult, tag);
            case 2:
              registry_result = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              registry_layers_ids = registry_result.registry_layers;
              non_existent_locally_ids = [];
              $ctx.state = 19;
              break;
            case 19:
              i = 0;
              $ctx.state = 15;
              break;
            case 15:
              $ctx.state = (i < registry_layers_ids.length) ? 9 : 13;
              break;
            case 12:
              i++;
              $ctx.state = 15;
              break;
            case 9:
              registry_layer = registry_layers_ids[i];
              $ctx.state = 10;
              break;
            case 10:
              $ctx.state = 6;
              return this.checkLocalLayer(registry_layer);
            case 6:
              local_layer = $ctx.sent;
              $ctx.state = 8;
              break;
            case 8:
              if (!local_layer) {
                non_existent_locally_ids.push(registry_layer);
              }
              $ctx.state = 12;
              break;
            case 13:
              $ctx.returnValue = ({
                registry_layers_ids: registry_layers_ids,
                non_existent_locally_ids: non_existent_locally_ids
              });
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  checkTotalLocalSizes: function(layers_id_list) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var sum_sizes,
          i,
          layer_id,
          local_layer;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              sum_sizes = 0;
              $ctx.state = 15;
              break;
            case 15:
              i = 0;
              $ctx.state = 11;
              break;
            case 11:
              $ctx.state = (i < layers_id_list.length) ? 5 : 9;
              break;
            case 8:
              i++;
              $ctx.state = 11;
              break;
            case 5:
              layer_id = layers_id_list[i];
              $ctx.state = 6;
              break;
            case 6:
              $ctx.state = 2;
              return this.checkLocalLayer(layer_id);
            case 2:
              local_layer = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              if (local_layer) {
                sum_sizes += local_layer.Size;
              }
              $ctx.state = 8;
              break;
            case 9:
              $ctx.returnValue = sum_sizes;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  },
  checkTotalLocalCount: function(layers_id_list) {
    return Q.async($traceurRuntime.initGeneratorFunction(function $__5() {
      var sum_count,
          i,
          layer_id,
          local_layer;
      return $traceurRuntime.createGeneratorInstance(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              sum_count = 0;
              $ctx.state = 15;
              break;
            case 15:
              i = 0;
              $ctx.state = 11;
              break;
            case 11:
              $ctx.state = (i < layers_id_list.length) ? 5 : 9;
              break;
            case 8:
              i++;
              $ctx.state = 11;
              break;
            case 5:
              layer_id = layers_id_list[i];
              $ctx.state = 6;
              break;
            case 6:
              $ctx.state = 2;
              return this.checkLocalLayer(layer_id);
            case 2:
              local_layer = $ctx.sent;
              $ctx.state = 4;
              break;
            case 4:
              if (local_layer) {
                sum_count = sum_count + 1;
              }
              $ctx.state = 8;
              break;
            case 9:
              $ctx.returnValue = sum_count;
              $ctx.state = -2;
              break;
            default:
              return $ctx.end();
          }
      }, $__5, this);
    }).bind(this))();
  }
}, {});
module.exports = {
  __esModule: true,
  get default() {
    return Syncronizer;
  }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN5bmNyb25pemVyL2luZGV4LmpzIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzAiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvOSIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xMCIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci84IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzciLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci82IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzQiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xNiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xNSIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci81IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzExIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztFQUFPLFVBQVEsRUNBZixFQUFDLGdDQUFvQixDQUFBLE9BQU0sQUFBQyxpQkFBa0IsQ0FDdEMsQ0FBQSxpQ0FBcUIsMENBQTJCLENBQUEsaUNBQXFCLEdBQUssRUFBQyxPQUFNLGdDQUFtQixDQUQ5RCxBQUMrRCxDQUFDO0VEQXZHLGVBQWEsRUNEcEIsRUFBQyxxQ0FBb0IsQ0FBQSxPQUFNLEFBQUMsc0JBQWtCLENBQ3RDLENBQUEsc0NBQXFCLCtDQUEyQixDQUFBLHNDQUFxQixHQUFLLEVBQUMsT0FBTSxxQ0FBbUIsQ0FEOUQsQUFDK0QsQ0FBQztFREN2RyxhQUFXLEVDRmxCLEVBQUMsbUNBQW9CLENBQUEsT0FBTSxBQUFDLG9CQUFrQixDQUN0QyxDQUFBLG9DQUFxQiw2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Ozs7OztBS3JjOUIsV0FBTyxDQ0FQLGVBQWMsd0JBQXdCLEFEQWQsQ0VBeEIsU0FBUyxJQUFHLENBQUc7QUFDVCxjQUFPLElBQUc7Ozt3QlBxY00sRUFBQTs7OztnQkFFSCxFQUFBOzs7O0FVeGNuQixpQkFBRyxNQUFNLEVBQUksQ0FBQSxDVndjUyxDQUFBLEVBQUksQ0FBQSxjQUFhLE9BQU8sQ1V4Y2YsUUFBd0MsQ0FBQztBQUNoRSxtQkFBSTs7QVZ1Y3FDLGNBQUEsRUFBRTs7Ozt1QkFDNUIsQ0FBQSxjQUFhLENBQUUsQ0FBQSxDQUFDOzs7OztBUXpjdkMsbUJSMGNnQyxDQUFBLElBQUcsZ0JBQWdCLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ1ExY3RDOzswQkNBdkIsQ0FBQSxJQUFHLEtBQUs7Ozs7QVQyY0EsaUJBQUssV0FBVSxDQUFJO0FBQ2pCLHdCQUFRLEVBQUksQ0FBQSxTQUFRLEVBQUksRUFBQSxDQUFDO2NBQzNCO0FBQUE7OztBVzdjUixpQkFBRyxZQUFZLEVYZ2RGLFVXaGRzQixBWGdkZCxDV2hkYzs7OztBQ0FuQyxtQkFBTyxDQUFBLElBQUcsSUFBSSxBQUFDLEVBQUMsQ0FBQTs7QUxDbUIsTUFDL0IsT0ZBNkIsS0FBRyxDQUFDLENBQUM7SUwrY2xDLENJamRtRCxLSmlkOUMsQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDLEFBQUMsRUFBQyxDQUFDO0VBQ2pCO0tHbGRtRjtBSHNkckYsS0FBSyxRQUFRLEVBQUk7QUFDZixXQUFTLENBQUcsS0FBRztBQUNmLElBQUksUUFBTSxFQUFJO0FBQUUsU0FBTyxZQUFVLENBQUM7RUFBRTtBQUFBLEFBQ3RDLENBQUM7QUFDRCIsImZpbGUiOiJzeW5jcm9uaXplci9pbmRleC5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBEb2NrZXJIdWIgICAgICBmcm9tICcuLi9kb2NrZXItaHViJztcbmltcG9ydCBEb2NrZXJSZWdpc3RyeSBmcm9tICcuLi9kb2NrZXItcmVnaXN0cnknO1xuaW1wb3J0IERvY2tlclJlbW90ZSAgIGZyb20gJy4uL2RvY2tlci1yZW1vdGUnO1xuaW1wb3J0IEZzSGVscGVyICAgICAgIGZyb20gJy4uL2ZzLWhlbHBlcic7XG5cbnZhciBwYXRoICAgICAgICA9IHJlcXVpcmUoJ3BhdGgnKTtcbnZhciBRICAgICAgICAgICA9IHJlcXVpcmUoJ3EnKTtcbnZhciBsb2cgICAgICAgICA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvbG9nZ2VyJyk7XG52YXIgXyAgICAgICAgICAgPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBwcmV0dHlCeXRlcyA9IHJlcXVpcmUoJ3ByZXR0eS1ieXRlcycpO1xudmFyIGFzeW5jICAgICAgID0gcmVxdWlyZSgnYXN5bmMnKTtcbnZhciBQcm9ncmVzc0JhciA9IHJlcXVpcmUoJ3Byb2dyZXNzJyk7XG52YXIgb3MgICAgICAgICAgPSByZXF1aXJlKCdvcycpO1xudmFyIGZzSGVscGVyICAgID0gbmV3IEZzSGVscGVyKCk7XG5cblEub25lcnJvciA9IGZ1bmN0aW9uKHRpdGxlLCBlcnIpIHtcbiAgbG9nLmVycm9yKCdcXG5cXG4nLCB0aXRsZSwgZXJyKTtcbiAgdGhyb3cgZXJyO1xufTtcblxuY2xhc3MgU3luY3Jvbml6ZXIge1xuXG4gIGNvbnN0cnVjdG9yKGRvY2tlcm9kZV9vcHRpb25zLCByZXF1ZXN0X29wdGlvbnMpIHtcbiAgICB0aGlzLmRvY2tlckh1YiA9IG5ldyBEb2NrZXJIdWIocmVxdWVzdF9vcHRpb25zKTtcbiAgICB0aGlzLmRvY2tlclJlZ2lzdHJ5ID0gbmV3IERvY2tlclJlZ2lzdHJ5KHJlcXVlc3Rfb3B0aW9ucyk7XG4gICAgdGhpcy5kb2NrZXJSZW1vdGUgPSBuZXcgRG9ja2VyUmVtb3RlKGRvY2tlcm9kZV9vcHRpb25zKTtcbiAgfVxuXG4gIGNvbXBhcmUoaHViUmVzdWx0LCB0YWcpIHtcbiAgICByZXR1cm4gUS5hc3luYyhmdW5jdGlvbiogKCkge1xuICAgICAgLy8gZ2V0IGVuZHBvaW50IGFuZCB0b2tlbiBmcm9tIGRvY2tlciBodWJcbiAgICAgIHZhciBpbWFnZUlkID0geWllbGQgdGhpcy5kb2NrZXJSZWdpc3RyeS5nZXRJbWFnZUlkQnlUYWcoaHViUmVzdWx0LCB0YWcpO1xuXG4gICAgICB2YXIgcmVnaXN0cnlBbmNlc3RvcnMgPSB5aWVsZCB0aGlzLmRvY2tlclJlZ2lzdHJ5LmFuY2VzdHJ5KGh1YlJlc3VsdCwgaW1hZ2VJZCk7XG4gICAgICBsb2cuaW5mbygnICByZWdpc3RyeSBsYXllcnMgY291bnQ6JywgcmVnaXN0cnlBbmNlc3RvcnMubGVuZ3RoKTtcblxuICAgICAgLy8gZ2V0IGZyb20gbG9jYWwgZG9ja2VyXG4gICAgICB2YXIgZnVsbFRhZ05hbWUgPSBodWJSZXN1bHQubmFtZXNwYWNlICsgJy8nICsgaHViUmVzdWx0LnJlcG9zaXRvcnkgKyAnOicgKyB0YWc7XG4gICAgICBpZiAoaHViUmVzdWx0Lm5hbWVzcGFjZSA9PT0gJ2xpYnJhcnknKSB7XG4gICAgICAgIGZ1bGxUYWdOYW1lID0gaHViUmVzdWx0LnJlcG9zaXRvcnkgKyAnOicgKyB0YWc7XG4gICAgICB9XG4gICAgICB2YXIgaW1hZ2VzRm91bmQgPSB5aWVsZCB0aGlzLmRvY2tlclJlbW90ZS5zZWFyY2hJbWFnZXNCeVRhZyhmdWxsVGFnTmFtZSk7XG5cbiAgICAgIGlmICghaW1hZ2VzRm91bmQgfHwgaW1hZ2VzRm91bmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdubyBsb2NhbCBpbWFnZXMgZm91bmQgZm9yICcgKyBmdWxsVGFnTmFtZSk7XG4gICAgICAgIGxvZy5kZWJ1ZygnXFxuXFxuOjogc3luY3Jvbml6ZXIgLSBjb21wYXJlIC0gbm8gbG9jYWwgaW1hZ2UgZm9yICcgKyBmdWxsVGFnTmFtZSArICcgOjonKTtcbiAgICAgICAgbG9nLmRlYnVnKHJlZ2lzdHJ5QW5jZXN0b3JzKTtcbiAgICAgICAgbG9nLmluZm8oJyAgbG9jYWwgbGF5ZXJzIGZvdW5kICAgOicsIDApO1xuICAgICAgICByZXR1cm4gcmVnaXN0cnlBbmNlc3RvcnM7XG4gICAgICB9XG5cbiAgICAgIHZhciBsb2NhbEFuY2VzdG9ycyA9IHlpZWxkIHRoaXMuZG9ja2VyUmVtb3RlLmFuc2Nlc3RvcnMoaW1hZ2VzRm91bmRbMF0uSWQpO1xuICAgICAgbG9nLmluZm8oJyAgICBsb2NhbCBsYXllcnMgZm91bmQ6JywgbG9jYWxBbmNlc3RvcnMubGVuZ3RoKTtcbiAgICAgIHZhciBsb2NhbEltYWdlSW5zcGVjdG9ycyA9IF8ucGx1Y2sobG9jYWxBbmNlc3RvcnMsICdpbWFnZUluc3BlY3QnKTtcblxuICAgICAgdmFyIGxvY2FsSWRzID0gXy5wbHVjayhsb2NhbEltYWdlSW5zcGVjdG9ycywgJ0lkJyk7XG4gICAgICB2YXIgZGlmZiA9IF8uZGlmZmVyZW5jZShyZWdpc3RyeUFuY2VzdG9ycywgbG9jYWxJZHMpO1xuICAgICAgbG9nLmRlYnVnKCdcXG5cXG46OiBzeW5jcm9uaXplciAtIGNvbXBhcmUgcmVnaXN0cnlBbmNlc3RvcnMgOjonKTtcbiAgICAgIGxvZy5kZWJ1ZyhyZWdpc3RyeUFuY2VzdG9ycyk7XG4gICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IHN5bmNyb25pemVyIC0gY29tcGFyZSBsb2NhbElkcyA6OicpO1xuICAgICAgbG9nLmRlYnVnKGxvY2FsSWRzKTtcbiAgICAgIGxvZy5kZWJ1ZygnXFxuXFxuOjogc3luY3Jvbml6ZXIgLSBjb21wYXJlIGRpZmYgOjonKTtcbiAgICAgIGxvZy5kZWJ1ZyhkaWZmKTtcbiAgICAgIGxvZy5pbmZvKCcgICAgZGlmZiBpbWFnZXM6JywgZGlmZi5sZW5ndGgpO1xuICAgICAgcmV0dXJuIGRpZmY7XG4gICAgfS5iaW5kKHRoaXMpKSgpO1xuICB9XG5cbiAgZ2V0U2l6ZXMoaHViUmVzdWx0LCBsYXllcnNMaXN0KSB7XG4gICAgcmV0dXJuIG5ldyBRLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGFsbENoZWNrcyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGF5ZXJzTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBsYXllcklEID0gbGF5ZXJzTGlzdFtpXTtcbiAgICAgICAgICBhbGxDaGVja3MucHVzaCh0aGlzLmRvY2tlclJlZ2lzdHJ5LmRvd25sb2FkSW1hZ2VHZXRTaXplKGh1YlJlc3VsdCwgbGF5ZXJJRCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMucGFyYWxsZWxMaW1pdChhbGxDaGVja3MsIDEwLFxuICAgICAgICBmdW5jdGlvbihlcnIsIHJlc3VsdHMpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHRvdGFsU2l6ZSA9IF8ucmVkdWNlKHJlc3VsdHMsIGZ1bmN0aW9uKHN1bSwgbnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VtICsgbnVtO1xuICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgbG9nLmRlYnVnKCdcXG5cXG46OiBzeW5jcm9uaXplciAtIGdldFNpemVzIDo6Jyk7XG4gICAgICAgICAgbG9nLmRlYnVnKCdsYXllcnM6JywgbGF5ZXJzTGlzdC5sZW5ndGgpO1xuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUodG90YWxTaXplKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLmVycm9yKGVyci5zdGFjayk7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG4gIH1cblxuICBjaGVja0Rvd25sb2FkZWRGaWxlcyhsYXllcnNMaXN0LCBvdXRwdXRQYXRoKSB7XG4gICAgcmV0dXJuIFEuYXN5bmMoZnVuY3Rpb24qICgpIHtcblxuICAgICAgdmFyIGxheWVyVG9Eb3dubG9hZCA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxheWVyc0xpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGxheWVySUQgPSBsYXllcnNMaXN0W2ldO1xuICAgICAgICB2YXIgZmlsZW5hbWUgPSBwYXRoLmpvaW4ob3V0cHV0UGF0aCwgbGF5ZXJJRCArICcudGFyJyk7XG4gICAgICAgIHZhciBmaWxlRXhpc3RzID0geWllbGQgZnNIZWxwZXIuZnNFeGlzdHMoZmlsZW5hbWUpO1xuICAgICAgICBpZiAoIWZpbGVFeGlzdHMpIHtcbiAgICAgICAgICBsYXllclRvRG93bmxvYWQucHVzaChsYXllcklEKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbGF5ZXJUb0Rvd25sb2FkO1xuICAgIH0uYmluZCh0aGlzKSkoKTtcbiAgfVxuXG4gIGRvd25sb2FkQ2FsbGJhY2soaHViUmVzdWx0LCBvdXRwdXRQYXRoLCBpbWFnZUlkLCBpUHJvZ3Jlc3MpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICB0cnkge1xuICAgICAgICBRLnNwYXduKGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgeWllbGQgdGhpcy5kb2NrZXJSZWdpc3RyeS5wcmVwYXJlTG9hZGluZyhcbiAgICAgICAgICAgIGh1YlJlc3VsdCwgb3V0cHV0UGF0aCwgaW1hZ2VJZCwgaVByb2dyZXNzKSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLmVycm9yKGVyci5zdGFjayk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgbG9hZENhbGxiYWNrKGh1YlJlc3VsdCwgb3V0cHV0UGF0aCwgaW1hZ2VJZCwgaVByb2dyZXNzKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgUS5hc3luYyhmdW5jdGlvbiogKCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0geWllbGQgdGhpcy5kb2NrZXJSZW1vdGUubG9hZEltYWdlKG91dHB1dFBhdGgsIGltYWdlSWQpO1xuICAgICAgICBpZiAoaVByb2dyZXNzKSB7XG4gICAgICAgICAgaVByb2dyZXNzKDEpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9LmJpbmQodGhpcykpKCk7XG4gICAgfS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgLy8gZW5kcG9pbnQgICAgOiBkb2NrZXIgcmVnaXN0cnkgZW5kcG9pbnQgZnJvbSBkb2NrZXJodWJcbiAgLy8gdG9rZW4gICAgICAgOiByZXBvc2l0b3J5IHRva2VuICAgICAgICAgZnJvbSBkb2NrZXJodWJcbiAgLy8gb3V0cHV0UGF0aCAgOiBsb2NhbCBmb2xkZXIgdG8gc2F2ZVxuICAvLyBpbWFnZUlkTGlzdCA6IGFsbCBJRHMgdG8gZG93bmxvYWRcbiAgZG93bmxvYWRMaXN0KGh1YlJlc3VsdCwgb3V0cHV0UGF0aCwgaW1hZ2VJZExpc3QsIGlQcm9ncmVzcykge1xuICAgIHJldHVybiBuZXcgUS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBhbGxEb3dubG9hZHMgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gKGltYWdlSWRMaXN0Lmxlbmd0aCAtIDEpOyBpID49IDAgOyBpLS0pIHtcbiAgICAgICAgICB2YXIgbGF5ZXJJRCA9IGltYWdlSWRMaXN0W2ldO1xuICAgICAgICAgIGFsbERvd25sb2Fkcy5wdXNoKHRoaXMuZG93bmxvYWRDYWxsYmFjayhodWJSZXN1bHQsIG91dHB1dFBhdGgsIGxheWVySUQsIGlQcm9ncmVzcykpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZG93bmxvYWRcbiAgICAgICAgYXN5bmMucGFyYWxsZWxMaW1pdChhbGxEb3dubG9hZHMsIDYsXG4gICAgICAgICAgZnVuY3Rpb24oZXJyLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IHN5bmNyb25pemVyIC0gZG93bmxvYWRBbmRMb2FkTGlzdCA6OicpO1xuICAgICAgICAgICAgbG9nLmRlYnVnKCdvdXRwdXRzOicsIHJlc3VsdHMpO1xuXG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9XG5cbiAgICB9LmJpbmQodGhpcykpO1xuICB9XG5cbiAgbG9hZExpc3QoaHViUmVzdWx0LCBvdXRwdXRQYXRoLCBpbWFnZUlkTGlzdCwgaVByb2dyZXNzKSB7XG4gICAgLy8gb3B0czoge1xuICAgIC8vICAgZW5kcG9pbnQgICAgOiBkb2NrZXIgcmVnaXN0cnkgZW5kcG9pbnQgZnJvbSBkb2NrZXJodWJcbiAgICAvLyAgIHRva2VuICAgICAgIDogcmVwb3NpdG9yeSB0b2tlbiAgICAgICAgIGZyb20gZG9ja2VyaHViXG4gICAgLy8gICBvdXRwdXRQYXRoICA6IGxvY2FsIGZvbGRlciB0byBzYXZlXG4gICAgLy8gICBpbWFnZUlkTGlzdCA6IGFsbCBJRHMgdG8gZG93bmxvYWRcbiAgICAvLyB9XG4gICAgcmV0dXJuIG5ldyBRLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGFsbExvYWRzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IChpbWFnZUlkTGlzdC5sZW5ndGggLSAxKTsgaSA+PSAwIDsgaS0tKSB7XG4gICAgICAgICAgdmFyIGxheWVySUQgPSBpbWFnZUlkTGlzdFtpXTtcbiAgICAgICAgICBhbGxMb2Fkcy5wdXNoKHRoaXMubG9hZENhbGxiYWNrKGh1YlJlc3VsdCwgb3V0cHV0UGF0aCwgbGF5ZXJJRCwgaVByb2dyZXNzKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBsb2FkXG4gICAgICAgIGFzeW5jLnBhcmFsbGVsTGltaXQoYWxsTG9hZHMsIDEsXG4gICAgICAgICAgZnVuY3Rpb24oZXJyLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IHN5bmNyb25pemVyIC0gZG93bmxvYWRBbmRMb2FkTGlzdCA6OicpO1xuICAgICAgICAgICAgbG9nLmRlYnVnKCdvdXRwdXRzOicsIHJlc3VsdHMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLmVycm9yKGVyci5zdGFjayk7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfVxuXG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHNldFRhZ3MoaHViUmVzdWx0KSB7XG4gICAgcmV0dXJuIFEuYXN5bmMoZnVuY3Rpb24qICgpIHtcblxuICAgICAgLy8gZ2V0IGFsbCB0YWdzXG4gICAgICB2YXIgdGFncyA9IHlpZWxkIHRoaXMuZG9ja2VyUmVnaXN0cnkudGFncyhodWJSZXN1bHQpO1xuICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAodmFyIG5hbWUgaW4gdGFncykge1xuICAgICAgICBpZiAodGFncy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgIHZhciB0YWdOYW1lID0gbmFtZTtcbiAgICAgICAgICB2YXIgaW1hZ2VJZCA9IHRhZ3NbbmFtZV07XG5cbiAgICAgICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IHN5bmNyb25pemVyIC0gc2V0VGFnIC0gc2VhcmNoIGltYWdlIDo6Jyk7XG4gICAgICAgICAgbG9nLmRlYnVnKHRhZ05hbWUsIGltYWdlSWQpO1xuICAgICAgICAgIHZhciByZXN1bHQgPSB5aWVsZCB0aGlzLmRvY2tlclJlbW90ZS5zZXRJbWFnZVRhZyhodWJSZXN1bHQubmFtZXNwYWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodWJSZXN1bHQucmVwb3NpdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnTmFtZSk7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfS5iaW5kKHRoaXMpKSgpO1xuXG4gIH1cblxuICBzeW5jKGh1YlJlc3VsdCwgdGFnLCBvdXRwdXRQYXRoLCBmb3JjZU92ZXJ3cml0ZSkge1xuICAgIHZhciBwcm9ncmVzc01lc3NhZ2UsIGJhciwgaVByb2dyZXNzO1xuICAgIHJldHVybiBRLmFzeW5jKGZ1bmN0aW9uKiAoKSB7XG5cbiAgICAgIGlmICghb3V0cHV0UGF0aCkge1xuICAgICAgICAvLyBubyBmb2xkZXIgd2FzIHNlbnQsIHNldCB0byAvdG1wXG4gICAgICAgIG91dHB1dFBhdGggPSB0aGlzLmdldE9zVGVtcERpcigpO1xuICAgICAgICBsb2cuaW5mbygnY3JlYXRpbmcgdGVtcCBmb2xkZXInLCBvdXRwdXRQYXRoKTtcbiAgICAgICAgeWllbGQgdGhpcy5jcmVhdGVBbmRDbGVhblRlbXBEaXIob3V0cHV0UGF0aCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBpbWFnZUZ1bGxOYW1lID0gaHViUmVzdWx0Lm5hbWVzcGFjZSArICcvJyArIGh1YlJlc3VsdC5yZXBvc2l0b3J5ICsgJzonICsgdGFnO1xuICAgICAgbG9nLmluZm8oJ3N5bmNpbmcnLCBpbWFnZUZ1bGxOYW1lKTtcbiAgICAgIGxvZy5pbmZvKCcgIGNvbXBhcmluZyBkb2NrZXIgcmVnaXN0cnkgd2l0aCBsb2NhbCBpbWFnZXMuLi4nKTtcbiAgICAgIC8vIGNvbXBhcmUgYWxsIGxvY2FsIGxheWVycyB3aXRoIHJlZ2lzdHJ5IGxheWVyc1xuICAgICAgdmFyIHRvdGFsTGF5ZXJzVG9Mb2FkID0geWllbGQgdGhpcy5jb21wYXJlKGh1YlJlc3VsdCwgdGFnKTtcblxuICAgICAgbG9nLmluZm8oJyAgZ2V0dGluZyB0b3RhbCBzaXplLi4uJyk7XG4gICAgICB2YXIgZGlmZkZpbGVzVG9Eb3dubG9hZDtcbiAgICAgIGlmIChmb3JjZU92ZXJ3cml0ZSkge1xuICAgICAgICAvLyB3aWxsIGRvd25sb2FkIGFuZCBvdmVyd3JpdGUgYWxsIGZpbGVzXG4gICAgICAgIGxvZy5pbmZvKCcgIChmb3JjZSBvdmVyd3JpdGUgaXMgYWN0aXZlKS4uLicpO1xuICAgICAgICBkaWZmRmlsZXNUb0Rvd25sb2FkID0gdG90YWxMYXllcnNUb0xvYWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB3aWxsIGRvd25sb2FkIG9ubHkgZmlsZXMgdGhhdCBkb2VzIG5vdCBleGlzdHNcbiAgICAgICAgbG9nLmluZm8oJyAgY2hlY2tpbmcgYWxyZWFkeSBkb3dubG9hZGVkIGZpbGVzLi4uJyk7XG4gICAgICAgIGRpZmZGaWxlc1RvRG93bmxvYWQgPSB5aWVsZCB0aGlzLmNoZWNrRG93bmxvYWRlZEZpbGVzKHRvdGFsTGF5ZXJzVG9Mb2FkLCBvdXRwdXRQYXRoKTtcbiAgICAgIH1cblxuICAgICAgLy8gY2FsY3VsYXRlIHRvdGFsIHNpemUgdG8gZG93bmxvYWRcbiAgICAgIHZhciB0b3RhbFNpemUgPSB5aWVsZCB0aGlzLmdldFNpemVzKGh1YlJlc3VsdCwgZGlmZkZpbGVzVG9Eb3dubG9hZCk7XG4gICAgICBpZiAodG90YWxTaXplID4gMCkge1xuICAgICAgICBpZiAoZGlmZkZpbGVzVG9Eb3dubG9hZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbG9nLmluZm8oJyAgZG93bmxvYWRpbmcgJyArIGRpZmZGaWxlc1RvRG93bmxvYWQubGVuZ3RoICsgJyBsYXllcnMgJyArIHByZXR0eUJ5dGVzKHRvdGFsU2l6ZSkgKyAnLi4uJyk7XG4gICAgICAgICAgcHJvZ3Jlc3NNZXNzYWdlID0gJyAgICAgICAgWzpiYXJdIDpwZXJjZW50ICggdGltZSBlbGFwc2VkOiA6ZWxhcHNlZCBzZWNvbmRzICknO1xuICAgICAgICAgIGJhciA9IG5ldyBQcm9ncmVzc0Jhcihwcm9ncmVzc01lc3NhZ2UsIHtcbiAgICAgICAgICAgIGNvbXBsZXRlOiAnPScsXG4gICAgICAgICAgICBpbmNvbXBsZXRlOiAnICcsXG4gICAgICAgICAgICB3aWR0aDogMjMsXG4gICAgICAgICAgICB0b3RhbDogdG90YWxTaXplXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaVByb2dyZXNzID0gZnVuY3Rpb24oY2h1bmtTaXplKSB7XG4gICAgICAgICAgICBiYXIudGljayhjaHVua1NpemUpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgeWllbGQgdGhpcy5kb3dubG9hZExpc3QoaHViUmVzdWx0LCBvdXRwdXRQYXRoLCBkaWZmRmlsZXNUb0Rvd25sb2FkLCBpUHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxvZy5pbmZvKCcgIGRvd25sb2FkIGZvbGRlcjogYCcgKyBvdXRwdXRQYXRoICsgJ2AnKTtcbiAgICAgIGxvZy5pbmZvKCcgIGxvYWRpbmcgJyArIHRvdGFsTGF5ZXJzVG9Mb2FkLmxlbmd0aCArICcgbGF5ZXJzLi4uJyk7XG4gICAgICBwcm9ncmVzc01lc3NhZ2UgPSAnICAgICAgICBbOmJhcl0gOnBlcmNlbnQgKCB0aW1lIGVsYXBzZWQ6IDplbGFwc2VkIHNlY29uZHMgKSc7XG4gICAgICBiYXIgPSBuZXcgUHJvZ3Jlc3NCYXIocHJvZ3Jlc3NNZXNzYWdlLCB7XG4gICAgICAgIGNvbXBsZXRlOiAnPScsXG4gICAgICAgIGluY29tcGxldGU6ICcgJyxcbiAgICAgICAgd2lkdGg6IDIzLFxuICAgICAgICB0b3RhbDogdG90YWxMYXllcnNUb0xvYWQubGVuZ3RoXG4gICAgICB9KTtcbiAgICAgIGlQcm9ncmVzcyA9IGZ1bmN0aW9uKG51bSkge1xuICAgICAgICBiYXIudGljayhudW0pO1xuICAgICAgfTtcbiAgICAgIHlpZWxkIHRoaXMubG9hZExpc3QoaHViUmVzdWx0LCBvdXRwdXRQYXRoLCB0b3RhbExheWVyc1RvTG9hZCwgaVByb2dyZXNzKTtcblxuICAgICAgbG9nLmluZm8oJyAgc2V0dGluZyB0YWdzLi4uJyk7XG4gICAgICB5aWVsZCB0aGlzLnNldFRhZ3MoaHViUmVzdWx0KTtcblxuICAgICAgbG9nLmluZm8oJ2ZpbmlzaGVkIGxvYWRpbmcnLCBpbWFnZUZ1bGxOYW1lKTtcblxuICAgICAgLy8gaWYgKG91dHB1dFBhdGggPT09IHRoaXMuZ2V0T3NUZW1wRGlyKCkpIHtcbiAgICAgIC8vICAgbG9nLmluZm8oJ3JlbW92aW5nIHRlbXAgZm9sZGVyJywgb3V0cHV0UGF0aCk7XG4gICAgICAvLyAgIHlpZWxkIHRoaXMucmVtb3ZlVGVtcERpcihvdXRwdXRQYXRoKTtcbiAgICAgIC8vIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfS5iaW5kKHRoaXMpKSgpO1xuICB9XG5cbiAgY3JlYXRlQW5kQ2xlYW5UZW1wRGlyKGRpcikge1xuICAgIHJldHVybiBmc0hlbHBlci5jcmVhdGVDbGVhbkZvbGRlcihkaXIpO1xuICB9XG5cbiAgY3JlYXRlVGVtcERpcihkaXIpIHtcbiAgICByZXR1cm4gZnNIZWxwZXIuY3JlYXRlRm9sZGVyKGRpcik7XG4gIH1cblxuICBnZXRPc1RlbXBEaXIoZm9sZGVyTmFtZSkge1xuICAgIHZhciB0ZW1wRm9sZGVyTmFtZSA9IGZvbGRlck5hbWUgfHwgJ2RvY2tlci1yZWdpc3RyeS1kb3dubG9hZGVyLXRlbXAnO1xuICAgIHJldHVybiBwYXRoLmpvaW4ob3MudG1wZGlyKCksIHRlbXBGb2xkZXJOYW1lKTtcbiAgfVxuXG4gIHJlbW92ZVRlbXBEaXIoZGlyKSB7XG4gICAgcmV0dXJuIGZzSGVscGVyLnJlbW92ZURpclJlY3Vyc2l2ZShkaXIpO1xuICB9XG5cbiAgZ2V0VG90YWxTaXplKGh1YlJlc3VsdCwgdGFnKSB7XG4gICAgcmV0dXJuIG5ldyBRLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgUS5zcGF3bihmdW5jdGlvbiogKCkge1xuXG4gICAgICAgICAgdmFyIGltYWdlRnVsbE5hbWUgPSBodWJSZXN1bHQubmFtZXNwYWNlICsgJy8nICsgaHViUmVzdWx0LnJlcG9zaXRvcnkgKyAnOicgKyB0YWc7XG4gICAgICAgICAgbG9nLmluZm8oJ2NvbXBhcmluZyBkb2NrZXIgcmVnaXN0cnkgd2l0aCBsb2NhbCBpbWFnZXMuLi4nKTtcbiAgICAgICAgICAvLyBjb21wYXJlIGFsbCBsb2NhbCBsYXllcnMgd2l0aCByZWdpc3RyeSBsYXllcnNcbiAgICAgICAgICB2YXIgdG90YWxMYXllcnNUb0xvYWQgPSB5aWVsZCB0aGlzLmNvbXBhcmUoaHViUmVzdWx0LCB0YWcpO1xuXG4gICAgICAgICAgLy8gY2FsY3VsYXRlIHRvdGFsIHNpemUgdG8gZG93bmxvYWRcbiAgICAgICAgICBsb2cuaW5mbygnZ2V0dGluZyB0b3RhbCBzaXplJywgaW1hZ2VGdWxsTmFtZSk7XG4gICAgICAgICAgdmFyIHRvdGFsU2l6ZSA9IHlpZWxkIHRoaXMuZ2V0U2l6ZXMoaHViUmVzdWx0LCB0b3RhbExheWVyc1RvTG9hZCk7XG4gICAgICAgICAgaWYgKHRvdGFsU2l6ZSA+IDAgJiYgdG90YWxMYXllcnNUb0xvYWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbG9nLmluZm8oJyAgbGF5ZXJzIHRvIGRvd25sb2FkOiAnICsgdG90YWxMYXllcnNUb0xvYWQubGVuZ3RoKTtcbiAgICAgICAgICAgIGxvZy5pbmZvKCcgIHRvdGFsIGxheWVycyBzaXplIDogJyArIHByZXR0eUJ5dGVzKHRvdGFsU2l6ZSkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgbGF5ZXJzQ291bnQ6IHRvdGFsTGF5ZXJzVG9Mb2FkLmxlbmd0aCxcbiAgICAgICAgICAgIHRvdGFsU2l6ZSAgOiB0b3RhbFNpemVcbiAgICAgICAgICB9KTtcblxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvcihlcnIuc3RhY2spO1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuICB9XG5cbiAgZ2V0VG90YWxMb2NhbFNpemUoaHViUmVzdWx0LCB0YWcpIHtcbiAgICByZXR1cm4gUS5hc3luYyhmdW5jdGlvbiogKCkge1xuXG4gICAgICAvLyBnZXQgZnJvbSBsb2NhbCBkb2NrZXJcbiAgICAgIHZhciBmdWxsVGFnTmFtZSA9IGh1YlJlc3VsdC5uYW1lc3BhY2UgKyAnLycgKyBodWJSZXN1bHQucmVwb3NpdG9yeSArICc6JyArIHRhZztcbiAgICAgIGlmIChodWJSZXN1bHQubmFtZXNwYWNlID09PSAnbGlicmFyeScpIHtcbiAgICAgICAgZnVsbFRhZ05hbWUgPSBodWJSZXN1bHQucmVwb3NpdG9yeSArICc6JyArIHRhZztcbiAgICAgIH1cbiAgICAgIHZhciBpbWFnZXNGb3VuZCA9IHlpZWxkIHRoaXMuZG9ja2VyUmVtb3RlLnNlYXJjaEltYWdlc0J5VGFnKGZ1bGxUYWdOYW1lKTtcblxuICAgICAgaWYgKCFpbWFnZXNGb3VuZCB8fCBpbWFnZXNGb3VuZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuICh7XG4gICAgICAgICAgdG90YWxfbG9jYWxfc2l6ZSA6IDAsXG4gICAgICAgICAgbG9jYWxBbmNlc3RvcnMgICA6IFtdLFxuICAgICAgICAgIGltYWdlc0ZvdW5kICAgICAgOiBpbWFnZXNGb3VuZCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB2YXIgbG9jYWxBbmNlc3RvcnMgPSB5aWVsZCB0aGlzLmRvY2tlclJlbW90ZS5hbnNjZXN0b3JzKGltYWdlc0ZvdW5kWzBdLklkKTtcblxuICAgICAgdmFyIHRvdGFsX2xvY2FsX3NpemUgPSBfLnJlZHVjZShsb2NhbEFuY2VzdG9ycywgZnVuY3Rpb24oc3VtLCBhbnNjZXN0b3IpIHtcbiAgICAgICAgcmV0dXJuIHN1bSArIGFuc2Nlc3Rvci5pbWFnZUluc3BlY3QuU2l6ZTtcbiAgICAgIH0sIDApO1xuXG4gICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IHN5bmNyb25pemVyIC0gZ2V0VG90YWxMb2NhbFNpemUgJyArIGZ1bGxUYWdOYW1lICsgJyA6OicpO1xuICAgICAgbG9nLmRlYnVnKHByZXR0eUJ5dGVzKHRvdGFsX2xvY2FsX3NpemUpKTtcblxuICAgICAgcmV0dXJuICh7XG4gICAgICAgIHRvdGFsX2xvY2FsX3NpemUgOiB0b3RhbF9sb2NhbF9zaXplLFxuICAgICAgICBsb2NhbEFuY2VzdG9ycyAgIDogbG9jYWxBbmNlc3RvcnMsXG4gICAgICAgIGltYWdlc0ZvdW5kICAgICAgOiBpbWFnZXNGb3VuZCxcbiAgICAgIH0pO1xuICAgIH0uYmluZCh0aGlzKSkoKTtcbiAgfVxuXG4gIGdldEFsbExheWVyc0Zyb21SZWdpc3RyeShodWJSZXN1bHQsIHRhZykge1xuICAgIHJldHVybiBRLmFzeW5jKGZ1bmN0aW9uKiAoKSB7XG4gICAgICAvLyBnZXQgZW5kcG9pbnQgYW5kIHRva2VuIGZyb20gZG9ja2VyIGh1YlxuICAgICAgdmFyIGltYWdlSWQgPSB5aWVsZCB0aGlzLmRvY2tlclJlZ2lzdHJ5LmdldEltYWdlSWRCeVRhZyhodWJSZXN1bHQsIHRhZyk7XG4gICAgICB2YXIgcmVnaXN0cnlBbmNlc3RvcnMgPSB5aWVsZCB0aGlzLmRvY2tlclJlZ2lzdHJ5LmFuY2VzdHJ5KGh1YlJlc3VsdCwgaW1hZ2VJZCk7XG5cbiAgICAgIHJldHVybiAoe1xuICAgICAgICBodWJfcmVzdWx0ICAgICAgOiBodWJSZXN1bHQsXG4gICAgICAgIGltYWdlX2lkICAgICAgICA6IGltYWdlSWQsXG4gICAgICAgIHJlZ2lzdHJ5X2xheWVycyA6IHJlZ2lzdHJ5QW5jZXN0b3JzXG4gICAgICB9KTtcbiAgICB9LmJpbmQodGhpcykpKCk7XG4gIH1cblxuICBjaGVja0xvY2FsTGF5ZXIoaW1hZ2VfaWQpIHtcbiAgICByZXR1cm4gUS5hc3luYyhmdW5jdGlvbiogKCkge1xuICAgICAgdmFyIGltYWdlID0geWllbGQgdGhpcy5kb2NrZXJSZW1vdGUuZ2V0SW1hZ2UoaW1hZ2VfaWQpO1xuICAgICAgdmFyIGluc3BlY3RlZF9pbWFnZSA9IHlpZWxkIHRoaXMuZG9ja2VyUmVtb3RlLmluc3BlY3RJbWFnZShpbWFnZSk7XG4gICAgICByZXR1cm4gaW5zcGVjdGVkX2ltYWdlO1xuICAgIH0uYmluZCh0aGlzKSkoKTtcbiAgfVxuXG4gIGdldExheWVyc0RpZmYoaHViUmVzdWx0LCB0YWcpIHtcbiAgICByZXR1cm4gUS5hc3luYyhmdW5jdGlvbiogKCkge1xuICAgICAgdmFyIHJlZ2lzdHJ5X3Jlc3VsdCA9IHlpZWxkIHRoaXMuZ2V0QWxsTGF5ZXJzRnJvbVJlZ2lzdHJ5KGh1YlJlc3VsdCwgdGFnKTtcbiAgICAgIHZhciByZWdpc3RyeV9sYXllcnNfaWRzID0gcmVnaXN0cnlfcmVzdWx0LnJlZ2lzdHJ5X2xheWVycztcblxuICAgICAgdmFyIG5vbl9leGlzdGVudF9sb2NhbGx5X2lkcyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlZ2lzdHJ5X2xheWVyc19pZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHJlZ2lzdHJ5X2xheWVyID0gcmVnaXN0cnlfbGF5ZXJzX2lkc1tpXTtcbiAgICAgICAgdmFyIGxvY2FsX2xheWVyID0geWllbGQgdGhpcy5jaGVja0xvY2FsTGF5ZXIocmVnaXN0cnlfbGF5ZXIpO1xuICAgICAgICBpZiAoIWxvY2FsX2xheWVyKSB7XG4gICAgICAgICAgbm9uX2V4aXN0ZW50X2xvY2FsbHlfaWRzLnB1c2gocmVnaXN0cnlfbGF5ZXIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoe1xuICAgICAgICByZWdpc3RyeV9sYXllcnNfaWRzICAgICAgOiByZWdpc3RyeV9sYXllcnNfaWRzLFxuICAgICAgICBub25fZXhpc3RlbnRfbG9jYWxseV9pZHMgOiBub25fZXhpc3RlbnRfbG9jYWxseV9pZHMsXG4gICAgICB9KTtcbiAgICB9LmJpbmQodGhpcykpKCk7XG4gIH1cblxuICBjaGVja1RvdGFsTG9jYWxTaXplcyhsYXllcnNfaWRfbGlzdCkge1xuICAgIHJldHVybiBRLmFzeW5jKGZ1bmN0aW9uKiAoKSB7XG4gICAgICB2YXIgc3VtX3NpemVzID0gMDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXllcnNfaWRfbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbGF5ZXJfaWQgPSBsYXllcnNfaWRfbGlzdFtpXTtcbiAgICAgICAgdmFyIGxvY2FsX2xheWVyID0geWllbGQgdGhpcy5jaGVja0xvY2FsTGF5ZXIobGF5ZXJfaWQpO1xuICAgICAgICBpZiAoIGxvY2FsX2xheWVyICkge1xuICAgICAgICAgIHN1bV9zaXplcyArPSBsb2NhbF9sYXllci5TaXplO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzdW1fc2l6ZXM7XG5cbiAgICB9LmJpbmQodGhpcykpKCk7XG4gIH1cblxuICBjaGVja1RvdGFsTG9jYWxDb3VudChsYXllcnNfaWRfbGlzdCkge1xuICAgIHJldHVybiBRLmFzeW5jKGZ1bmN0aW9uKiAoKSB7XG4gICAgICB2YXIgc3VtX2NvdW50ID0gMDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXllcnNfaWRfbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbGF5ZXJfaWQgPSBsYXllcnNfaWRfbGlzdFtpXTtcbiAgICAgICAgdmFyIGxvY2FsX2xheWVyID0geWllbGQgdGhpcy5jaGVja0xvY2FsTGF5ZXIobGF5ZXJfaWQpO1xuICAgICAgICBpZiAoIGxvY2FsX2xheWVyICkge1xuICAgICAgICAgIHN1bV9jb3VudCA9IHN1bV9jb3VudCArIDE7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN1bV9jb3VudDtcbiAgICB9LmJpbmQodGhpcykpKCk7XG4gIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgZ2V0IGRlZmF1bHQoKSB7IHJldHVybiBTeW5jcm9uaXplcjsgfVxufTtcbiIsIigkX19wbGFjZWhvbGRlcl9fMCA9IHJlcXVpcmUoJF9fcGxhY2Vob2xkZXJfXzEpLCBcbiAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzIgJiYgJF9fcGxhY2Vob2xkZXJfXzMuX19lc01vZHVsZSAmJiAkX19wbGFjZWhvbGRlcl9fNCB8fCB7ZGVmYXVsdDogJF9fcGxhY2Vob2xkZXJfXzV9KSIsInZhciAkX19wbGFjZWhvbGRlcl9fMCA9ICRfX3BsYWNlaG9sZGVyX18xIiwiKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoJF9fcGxhY2Vob2xkZXJfXzAsICRfX3BsYWNlaG9sZGVyX18xLCAkX19wbGFjZWhvbGRlcl9fMikiLCIkdHJhY2V1clJ1bnRpbWUuaW5pdEdlbmVyYXRvckZ1bmN0aW9uKCRfX3BsYWNlaG9sZGVyX18wKSIsInJldHVybiAkX19wbGFjZWhvbGRlcl9fMChcbiAgICAgICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzEsXG4gICAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18yLCB0aGlzKTsiLCIkdHJhY2V1clJ1bnRpbWUuY3JlYXRlR2VuZXJhdG9ySW5zdGFuY2UiLCJmdW5jdGlvbigkY3R4KSB7XG4gICAgICB3aGlsZSAodHJ1ZSkgJF9fcGxhY2Vob2xkZXJfXzBcbiAgICB9IiwicmV0dXJuICRfX3BsYWNlaG9sZGVyX18wIiwiJGN0eC5zZW50IiwiJGN0eC5zdGF0ZSA9ICgkX19wbGFjZWhvbGRlcl9fMCkgPyAkX19wbGFjZWhvbGRlcl9fMSA6ICRfX3BsYWNlaG9sZGVyX18yO1xuICAgICAgICBicmVhayIsIiRjdHgucmV0dXJuVmFsdWUgPSAkX19wbGFjZWhvbGRlcl9fMCIsInJldHVybiAkY3R4LmVuZCgpIiwiJGN0eC5tYXliZVRocm93KCkiXX0=