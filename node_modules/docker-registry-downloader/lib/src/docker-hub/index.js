"use strict";
var request = require('requestretry');
var DOCKER_HUB_URL = 'https://index.docker.io';
var Q = require('q');
var request = require('requestretry');
var log = require('../helpers/logger');
var _ = require('lodash');
var DockerHub = function DockerHub(request_options) {
  this.__request_options = request_options || {};
};
($traceurRuntime.createClass)(DockerHub, {
  get request_options() {
    return this.__request_options;
  },
  set request_options(value) {
    this.__request_options = value;
  },
  auth: function(namespace, user, password) {
    return new Q.Promise(function(resolve, reject) {
      var url = DOCKER_HUB_URL + '/v1/repositories/' + namespace + '/auth';
      request.get(url).auth(user, password, false, function(error, response) {
        if (!error && response.statusCode == 200) {
          log.debug('\n\n:: docker-hub - auth ::');
          log.debug(response.headers);
          resolve(response.headers['set-cookie']);
        } else {
          reject(error);
        }
      });
    });
  },
  images: function(namespace, repository) {
    var request_options_local = this.__request_options;
    return new Q.Promise(function(resolve, reject) {
      var options = _.assign({
        url: DOCKER_HUB_URL + '/v1/repositories/' + namespace + '/' + repository + '/images',
        headers: {'X-Docker-Token': 'true'}
      }, request_options_local);
      function callback(error, response) {
        if (!error && response.statusCode == 200) {
          log.debug('\n\n:: docker-hub - images ::');
          var result = {
            namespace: namespace,
            repository: repository,
            endpoint: response.headers['x-docker-endpoints'],
            token: response.headers['x-docker-token']
          };
          log.debug(result);
          resolve(result);
        } else {
          reject(error);
        }
      }
      request(options, callback);
    });
  },
  search: function(query) {
    var request_options_local = this.__request_options;
    return new Q.Promise(function(resolve, reject) {
      var options = _.assign({
        url: DOCKER_HUB_URL + '/v1/search',
        qs: {q: query}
      }, request_options_local);
      function callback(error, response, body) {
        if (!error && response.statusCode == 200) {
          var result = JSON.parse(body);
          log.debug('\n\n:: docker-hub - search ::');
          log.debug(result);
          resolve(result);
        } else {
          reject(error);
        }
      }
      request(options, callback);
    });
  }
}, {});
module.exports = {
  __esModule: true,
  get default() {
    return DockerHub;
  }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRvY2tlci1odWIvaW5kZXguanMiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvOSIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xMCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLEFBQUksRUFBQSxDQUFBLE9BQU0sRUFBVyxDQUFBLE9BQU0sQUFBQyxDQUFDLGNBQWEsQ0FBQyxDQUFDO0FBQzVDLEFBQUksRUFBQSxDQUFBLGNBQWEsRUFBSSwwQkFBd0IsQ0FBQztBQUM5QyxBQUFJLEVBQUEsQ0FBQSxDQUFBLEVBQWlCLENBQUEsT0FBTSxBQUFDLENBQUMsR0FBRSxDQUFDLENBQUM7QUFDakMsQUFBSSxFQUFBLENBQUEsT0FBTSxFQUFXLENBQUEsT0FBTSxBQUFDLENBQUMsY0FBYSxDQUFDLENBQUM7QUFDNUMsQUFBSSxFQUFBLENBQUEsR0FBRSxFQUFlLENBQUEsT0FBTSxBQUFDLENBQUMsbUJBQWtCLENBQUMsQ0FBQztBQUNqRCxBQUFJLEVBQUEsQ0FBQSxDQUFBLEVBQWlCLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDLENBQUM7QUNMdEMsQUFBSSxFQUFBLFlET0osU0FBTSxVQUFRLENBRUEsZUFBYyxDQUFHO0FBQzNCLEtBQUcsa0JBQWtCLEVBQUksQ0FBQSxlQUFjLEdBQUssR0FBQyxDQUFDO0FDVlYsQURXdEMsQ0NYc0M7QUNBeEMsQUFBQyxlQUFjLFlBQVksQ0FBQyxBQUFDO0FGYTNCLElBQUksZ0JBQWMsRUFBSTtBQUNwQixTQUFPLENBQUEsSUFBRyxrQkFBa0IsQ0FBQztFQUMvQjtBQUVBLElBQUksZ0JBQWMsQ0FBRSxLQUFJLENBQUc7QUFDekIsT0FBRyxrQkFBa0IsRUFBSSxNQUFJLENBQUM7RUFDaEM7QUFFQSxLQUFHLENBQUgsVUFBTSxTQUFRLENBQUcsQ0FBQSxJQUFHLENBQUcsQ0FBQSxRQUFPLENBQUc7QUFDL0IsU0FBTyxJQUFJLENBQUEsQ0FBQSxRQUFRLEFBQUMsQ0FB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LGFBQVMsU0FBTyxDQUFFLEtBQUksQ0FBRyxDQUFBLFFBQU8sQ0FBRyxDQUFBLElBQUcsQ0FBRztBQUN2QyxXQUFJLENBQUMsS0FBSSxDQUFBLEVBQUssQ0FBQSxRQUFPLFdBQVcsR0FBSyxJQUFFLENBQUc7QUFrQnhDLEFBQUksWUFBQSxDQUFBLE1BQUssRUFBSSxDQUFBLElBQUcsTUFBTSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7QUFDN0IsWUFBRSxNQUFNLEFBQUMsQ0FBQywrQkFBOEIsQ0FBQyxDQUFDO0FBQzFDLFlBQUUsTUFBTSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUM7QUFDakIsZ0JBQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO1FBQ2pCLEtBQU87QUFDTCxlQUFLLEFBQUMsQ0FBQyxLQUFJLENBQUMsQ0FBQztRQUNmO0FBQUEsTUFDRjtBQUFBLEFBQ0EsWUFBTSxBQUFDLENBQUMsT0FBTSxDQUFHLFNBQU8sQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQztFQUNKO0FBQUEsS0VoSG1GO0FGb0hyRixLQUFLLFFBQVEsRUFBSTtBQUNmLFdBQVMsQ0FBRyxLQUFHO0FBQ2YsSUFBSSxRQUFNLEVBQUk7QUFBRSxTQUFPLFVBQVEsQ0FBQztFQUFFO0FBQUEsQUFDcEMsQ0FBQztBQUNEIiwiZmlsZSI6ImRvY2tlci1odWIvaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVxdWVzdCAgICAgICAgPSByZXF1aXJlKCdyZXF1ZXN0cmV0cnknKTtcbnZhciBET0NLRVJfSFVCX1VSTCA9ICdodHRwczovL2luZGV4LmRvY2tlci5pbyc7XG52YXIgUSAgICAgICAgICAgICAgPSByZXF1aXJlKCdxJyk7XG52YXIgcmVxdWVzdCAgICAgICAgPSByZXF1aXJlKCdyZXF1ZXN0cmV0cnknKTtcbnZhciBsb2cgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvbG9nZ2VyJyk7XG52YXIgXyAgICAgICAgICAgICAgPSByZXF1aXJlKCdsb2Rhc2gnKTtcblxuY2xhc3MgRG9ja2VySHViIHtcblxuICBjb25zdHJ1Y3RvcihyZXF1ZXN0X29wdGlvbnMpIHtcbiAgICB0aGlzLl9fcmVxdWVzdF9vcHRpb25zID0gcmVxdWVzdF9vcHRpb25zIHx8IHt9O1xuICB9XG5cbiAgZ2V0IHJlcXVlc3Rfb3B0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlcXVlc3Rfb3B0aW9ucztcbiAgfVxuXG4gIHNldCByZXF1ZXN0X29wdGlvbnModmFsdWUpIHtcbiAgICB0aGlzLl9fcmVxdWVzdF9vcHRpb25zID0gdmFsdWU7XG4gIH1cblxuICBhdXRoIChuYW1lc3BhY2UsIHVzZXIsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuIG5ldyBRLlByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHVybCA9IERPQ0tFUl9IVUJfVVJMICsgJy92MS9yZXBvc2l0b3JpZXMvJyArIG5hbWVzcGFjZSArICcvYXV0aCc7XG4gICAgICByZXF1ZXN0LmdldCh1cmwpLmF1dGgodXNlciwgcGFzc3dvcmQsIGZhbHNlLCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlLyosIGJvZHkqLykge1xuICAgICAgICBpZiAoIWVycm9yICYmIHJlc3BvbnNlLnN0YXR1c0NvZGUgPT0gMjAwKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKCdcXG5cXG46OiBkb2NrZXItaHViIC0gYXV0aCA6OicpO1xuICAgICAgICAgIGxvZy5kZWJ1ZyhyZXNwb25zZS5oZWFkZXJzKTtcbiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmhlYWRlcnNbJ3NldC1jb29raWUnXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBpbWFnZXMgKG5hbWVzcGFjZSwgcmVwb3NpdG9yeSkge1xuICAgIHZhciByZXF1ZXN0X29wdGlvbnNfbG9jYWwgPSB0aGlzLl9fcmVxdWVzdF9vcHRpb25zO1xuICAgIHJldHVybiBuZXcgUS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHZhciBvcHRpb25zID0gXy5hc3NpZ24oe1xuICAgICAgICAgIHVybDogRE9DS0VSX0hVQl9VUkwgKyAnL3YxL3JlcG9zaXRvcmllcy8nICsgbmFtZXNwYWNlICsgJy8nICsgcmVwb3NpdG9yeSArICcvaW1hZ2VzJyxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnWC1Eb2NrZXItVG9rZW4nOiAndHJ1ZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVlc3Rfb3B0aW9uc19sb2NhbFxuICAgICAgKTtcbiAgICAgIGZ1bmN0aW9uIGNhbGxiYWNrKGVycm9yLCByZXNwb25zZS8qLCBib2R5Ki8pIHtcbiAgICAgICAgaWYgKCFlcnJvciAmJiByZXNwb25zZS5zdGF0dXNDb2RlID09IDIwMCkge1xuXG4gICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgLy8gcmVzcG9uc2UuaGVhZGVyc1xuICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgIC8vIFgtRG9ja2VyLUVuZHBvaW50cyDihpIgcmVnaXN0cnktMS5kb2NrZXIuaW9cbiAgICAgICAgICAvLyBYLURvY2tlci1Ub2tlbiDihpIgc2lnbmF0dXJlPTBhZWVhNmJjOTFhNGQxZDBmZjc4OTJjOWMxMDFkZjE3Y2U5YzhhNjAscmVwb3NpdG9yeT1cImF6dWtpYXBwL2F6a3RjbFwiLGFjY2Vzcz1yZWFkXG4gICAgICAgICAgbG9nLmRlYnVnKCdcXG5cXG46OiBkb2NrZXItaHViIC0gaW1hZ2VzIDo6Jyk7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgIG5hbWVzcGFjZSAgOiBuYW1lc3BhY2UsXG4gICAgICAgICAgICByZXBvc2l0b3J5IDogcmVwb3NpdG9yeSxcbiAgICAgICAgICAgIGVuZHBvaW50ICAgOiByZXNwb25zZS5oZWFkZXJzWyd4LWRvY2tlci1lbmRwb2ludHMnXSxcbiAgICAgICAgICAgIHRva2VuICAgICAgOiByZXNwb25zZS5oZWFkZXJzWyd4LWRvY2tlci10b2tlbiddLFxuICAgICAgICAgIH07XG4gICAgICAgICAgbG9nLmRlYnVnKHJlc3VsdCk7XG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlcXVlc3Qob3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH0pO1xuICB9XG5cbiAgc2VhcmNoIChxdWVyeSkge1xuICAgIHZhciByZXF1ZXN0X29wdGlvbnNfbG9jYWwgPSB0aGlzLl9fcmVxdWVzdF9vcHRpb25zO1xuICAgIHJldHVybiBuZXcgUS5Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHZhciBvcHRpb25zID0gXy5hc3NpZ24oe1xuICAgICAgICAgIHVybDogRE9DS0VSX0hVQl9VUkwgKyAnL3YxL3NlYXJjaCcsXG4gICAgICAgICAgcXM6IHtcbiAgICAgICAgICAgIHE6IHF1ZXJ5XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0X29wdGlvbnNfbG9jYWxcbiAgICAgICk7XG4gICAgICBmdW5jdGlvbiBjYWxsYmFjayhlcnJvciwgcmVzcG9uc2UsIGJvZHkpIHtcbiAgICAgICAgaWYgKCFlcnJvciAmJiByZXNwb25zZS5zdGF0dXNDb2RlID09IDIwMCkge1xuICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgIC8vIHNlYXJjaCBib2R5IHJlc3VsdFxuICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgIC8vIHtcbiAgICAgICAgICAvLyAgICBcInF1ZXJ5XCI6XCJhemt0Y2xcIixcbiAgICAgICAgICAvLyAgICBcIm51bV9yZXN1bHRzXCI6MSxcbiAgICAgICAgICAvLyAgICBcInJlc3VsdHNcIjpbXG4gICAgICAgICAgLy8gICAgICAge1xuICAgICAgICAgIC8vICAgICAgICAgIFwiaXNfYXV0b21hdGVkXCI6dHJ1ZSxcbiAgICAgICAgICAvLyAgICAgICAgICBcIm5hbWVcIjpcImF6dWtpYXBwL2F6a3RjbFwiLFxuICAgICAgICAgIC8vICAgICAgICAgIFwiaXNfdHJ1c3RlZFwiOnRydWUsXG4gICAgICAgICAgLy8gICAgICAgICAgXCJpc19vZmZpY2lhbFwiOmZhbHNlLFxuICAgICAgICAgIC8vICAgICAgICAgIFwic3Rhcl9jb3VudFwiOjAsXG4gICAgICAgICAgLy8gICAgICAgICAgXCJkZXNjcmlwdGlvblwiOlwiXCJcbiAgICAgICAgICAvLyAgICAgICB9XG4gICAgICAgICAgLy8gICAgXVxuICAgICAgICAgIC8vIH1cbiAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShib2R5KTtcbiAgICAgICAgICBsb2cuZGVidWcoJ1xcblxcbjo6IGRvY2tlci1odWIgLSBzZWFyY2ggOjonKTtcbiAgICAgICAgICBsb2cuZGVidWcocmVzdWx0KTtcbiAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVxdWVzdChvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfSk7XG4gIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgZ2V0IGRlZmF1bHQoKSB7IHJldHVybiBEb2NrZXJIdWI7IH1cbn07XG4iLCJ2YXIgJF9fcGxhY2Vob2xkZXJfXzAgPSAkX19wbGFjZWhvbGRlcl9fMSIsIigkdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MpKCRfX3BsYWNlaG9sZGVyX18wLCAkX19wbGFjZWhvbGRlcl9fMSwgJF9fcGxhY2Vob2xkZXJfXzIpIl19